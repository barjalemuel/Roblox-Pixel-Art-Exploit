import tkinter
import tkinter.filedialog as filedialog
import json
import pyperclip
from PIL import Image

app_title = "Pixel Data"


class App(tkinter.Tk):
    def __init__(self):
        super().__init__()
        self.filename = None
        self.size = None
        self.canvasSize = tkinter.IntVar()
        self.canvasSizes = [24, 32, 56, 48, 64, 100]
        self.frame_bd = 4
        self.button_width = 15
        self.initialize()

    def initialize(self):
        # Frames
        buttonFrame = tkinter.LabelFrame(
            self, text="Buttons", relief='sunken', bd=self.frame_bd)
        buttonFrame.grid(column=0, row=0, padx=10, pady=5)

        radioFrame = tkinter.LabelFrame(
            self, text="Canvas Size", relief='sunken', bd=self.frame_bd)
        radioFrame.grid(column=0, row=1, padx=10, pady=10)

        # Buttons
        getImage = tkinter.Button(
            buttonFrame, text="Select Image", width=self.button_width, command=self.getImage)
        getImage.grid(column=0, row=0, pady=1.5)

        getData = tkinter.Button(
            buttonFrame, text="Get Data", width=self.button_width, command=self.getData)
        getData.grid(column=0, row=1, pady=1.5, padx=1.5)

        # Radial Buttons
        row = 0
        column = 1

        for i in range(len(self.canvasSizes)):
            size = self.canvasSizes[i]
            text = "{size}x{size}".format(size=size)

            if i % 2 == 0:
                column = 0
                row += 1
            else:
                column = 1

            radioButton = tkinter.Radiobutton(
                radioFrame, text=text, value=size, variable=self.canvasSize)
            radioButton.grid(column=column, row=row)

    def getImage(self):
        self.filename = filedialog.askopenfilename(filetypes=[("Image Files", ('.png', '.jpg', '.jpeg'))],
                                                   title="Choose an image file.")

    def getData(self):
        filename = self.filename
        canvasSize = self.canvasSize.get()

        if not filename or canvasSize == 0:
            print("Data not fulfilled")
            return

        pixelData = []
        count = 0
        image = Image.open(filename)
        image = image.resize((canvasSize, canvasSize))
        image = image.rotate(180)

        for row in range(canvasSize):
            for column in range(canvasSize):
                count += 1
                rgb = image.getpixel((row, column))
                hexx = "{:02x}{:02x}{:02x}".format(*rgb)

                data = {hexx: count}
                pixelData.append(data)

        jsonPixelData = json.dumps(pixelData)
        pyperclip.copy(jsonPixelData)


app = App()
app.title(app_title)
app.mainloop()
